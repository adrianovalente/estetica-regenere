{% extends "index.html" %}

{%block conteudo_interior%}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script  type="text/javascript">

  var dates;
  var selectedClientId;

  var getAreas = function(clientId) {
    selectedClientId = clientId;
    // TODO: Remove this migue
  }

  var getServices = function(areaId) {
    console.log("Buscando serviços para área " + areaId)
    $.get("/services/" + areaId, function(data, status){
      $("#services").empty();
      $("#dates").empty();
      $("#times").empty();
      $("#services").append("<option value = '0'>Selecione</option>");
      for (var i=0; i<data.content.services.length; i++) {
        var service = data.content.services[i]
        $("#services").append("<option value = '" + service.id + "'>" + service.name + "</option>");
      }
      console.log(data);
      });
  };

  var getDates = function(serviceId) {

    console.log("Buscando datas e horarios para o servico " + serviceId);
    $.get("/timeswithclient/" + serviceId + "/" + selectedClientId, function(data, status){
      $("#dates").empty();
      $("#times").empty();
      $("#dates").append("<option value = '0'>Selecione</option>");
      console.log(data);
      for (var i=0; i<data.contents.dates.length; i++) {
        date = data.contents.dates[i];
        $("#dates").append("<option value = '" + i.toString() + "'>" + date.date + "</option>");
      }
      dates = data.contents.dates;
      console.log(data);
    });
  };

  var populateTimes = function(dataId) {

    console.log("Populando tempos com id " + dataId);

    $("#times").empty();
    $("#times").append("<option value = '0'>Selecione</option>");
    for (var i=0; i<dates[parseInt(dataId)].times.length; i++) {
      $("#times").append("<option value = '" + dates[parseInt(dataId)].date + "-" + dates[parseInt(dataId)].times[i] + "'>" + dates[parseInt(dataId)].times[i] + "</option>");
    }
  };
</script>

</script>

<div class="shell">

  <!-- Small Nav -->
  <div class="small-nav">
    <a href="#">Regenere</a>
    <span>&gt;</span>
    Marcar consulta
  </div>
  <!-- End Small Nav -->

  <br />
  <!-- Main -->
  <div id="main">
    <div class="cl">&nbsp;</div>

    <!-- Content -->
    <div id="content">


      <!-- Box -->
      <div class="box">
        <!-- Box Head -->
        <div class="box-head">
          <h2>Marcar consulta</h2>
        </div>
        <!-- End Box Head -->

        <form action="" method="post">

          <!-- Form -->
          <div class="form">
              {% csrf_token %}

              <p class="inline-field">
                <label>Nome da cliente</label>
                <select class="field size4" name="name" id="clients" onchange="getAreas(this.options[this.selectedIndex].value);">
                  <option value="0">Selecione</option>
                  {% for cliente in clientes %}
                    <option value="{{cliente.id}}">{{cliente.name}}</option>
                  {% endfor %}
                </select>
              </p>
              <p class="inline-field">
                <label>Área da estética</label>
                <select class="field size4" name="area" onchange="getServices(this.options[this.selectedIndex].value);">
                  <option value="0">Selecione</option>
                  {% for area in areas %}
                    <option value="{{area.id}}">{{area.name}}</option>
                  {% endfor %}
                </select>
              </p>
              <p class="inline-field">
                <label>Serviço</label>
                <select class="field size4" name="service" onchange="getDates(this.options[this.selectedIndex].value);" id="services">
                </select>
              </p>

              <p class="inline-field">
                <label>Data</label>
                <select class="field size4" name="date" onchange="populateTimes(this.options[this.selectedIndex].value);" id="dates">
                </select>
              </p>

              <p class="inline-field">
                <label>Horário</label>
                <select class="field size4" name="time" id="times">
                </select>
              </p>

          </div>
          <!-- End Form -->
          <!-- Form Buttons -->
          <div class="buttons">
            <input type="submit" class="button" value="Marcar consulta" />
          </div>
          <!-- End Form Buttons -->
        </form>
      </div>
      <!-- End Box -->


    </div>
    <!-- End Content -->

    <div class="cl">&nbsp;</div>
  </div>
  <!-- Main -->
</div>


{% endblock %}
